/* 1 */
SELECT f.*
FROM flights f
JOIN airline a ON f.airline_id = a.airline_id
WHERE a.airline_name = 'Air Astana';


/* 2 */
SELECT 
    f.flight_id,
    f.flight_no,
    ap.airport_name AS departure_airport
FROM flights f
JOIN airport ap ON f.departure_airport_id = ap.airport_id;


/* 3 */
SELECT a.airline_id, a.airline_name
FROM airline a
LEFT JOIN flights f 
    ON a.airline_id = f.airline_id
    AND f.scheduled_departure BETWEEN CURRENT_DATE 
                                 AND (CURRENT_DATE + INTERVAL '1 month')
WHERE f.flight_id IS NULL;


/* 4 */
SELECT 
    p.passenger_id,
    p.first_name,
    p.last_name
FROM passengers p
JOIN booking b ON p.passenger_id = b.passenger_id
JOIN booking_flight bf ON b.booking_id = bf.booking_id
WHERE bf.flight_id = 101;


/* 5 */
SELECT 
    bf.flight_id,
    AVG(b.price) AS avg_price,
    SUM(b.price) AS total_price,
    MAX(b.price) AS max_price,
    MIN(b.price) AS min_price
FROM booking_flight bf
JOIN booking b ON bf.booking_id = b.booking_id
GROUP BY bf.flight_id;


/* 6 */
SELECT 
    f.flight_id,
    f.flight_no,
    a.airline_name,
    dep.airport_name AS departure_airport,
    arr.airport_name AS arrival_airport,
    arr.country AS arrival_country
FROM flights f
JOIN airline a ON f.airline_id = a.airline_id
JOIN airport dep ON f.departure_airport_id = dep.airport_id
JOIN airport arr ON f.arrival_airport_id = arr.airport_id
WHERE arr.country = 'China';


/* 7 */
SELECT 
    p.passenger_id,
    p.first_name,
    p.last_name,
    arr.airport_name AS arrival_airport,
    arr.country AS arrival_country
FROM passengers p
JOIN booking b ON p.passenger_id = b.passenger_id
JOIN booking_flight bf ON b.booking_id = bf.booking_id
JOIN flights f ON bf.flight_id = f.flight_id
JOIN airport arr ON f.arrival_airport_id = arr.airport_id
WHERE AGE(p.date_of_birth) < INTERVAL '18 years';


/* 8 */
SELECT 
    p.first_name || ' ' || p.last_name AS full_name,
    p.passport_number,
    f.scheduled_arrival AS arrival_time
FROM passengers p
JOIN booking b ON p.passenger_id = b.passenger_id
JOIN booking_flight bf ON b.booking_id = bf.booking_id
JOIN flights f ON bf.flight_id = f.flight_id;


/* 9 */
SELECT 
    dep.country AS airport_country,
    f.flight_id,
    a.airline_name,
    a.airline_country
FROM flights f
JOIN airline a ON f.airline_id = a.airline_id
JOIN airport dep ON f.departure_airport_id = dep.airport_id
WHERE a.airline_country = dep.country
GROUP BY dep.country, f.flight_id, a.airline_name, a.airline_country;


/* DEFENSE!!! */

/* 1 */
SELECT 
    b.booking_id,
    p.first_name || ' ' || p.last_name AS passenger_full_name,
    f.flight_no,
    f.scheduled_departure,
    f.scheduled_arrival,
    al.airline_name
FROM booking b
JOIN passengers p ON b.passenger_id = p.passenger_id
JOIN booking_flight bf ON b.booking_id = bf.booking_id
JOIN flights f ON bf.flight_id = f.flight_id
JOIN airline al ON f.airline_id = al.airline_id
ORDER BY b.booking_id;


/* 2 */
SELECT 
    f.flight_id,
    f.flight_no,
    COUNT(bf.booking_id) AS passenger_count
FROM flights f
LEFT JOIN booking_flight bf ON f.flight_id = bf.flight_id
GROUP BY f.flight_id, f.flight_no
ORDER BY f.flight_id;


/* 3 */
SELECT 
    f.flight_id,
    f.flight_no,
    dep.airport_name AS departure_airport,
    arr.airport_name AS arrival_airport,
    al.airline_name
FROM flights f
JOIN airport dep ON f.departure_airport_id = dep.airport_id
JOIN airport arr ON f.arrival_airport_id = arr.airport_id
JOIN airline al ON f.airline_id = al.airline_id
ORDER BY f.flight_id;
